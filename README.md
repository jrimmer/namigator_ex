# Namigator_ex

> **Note:** This project is currently in testing. Contributions and commentary are welcome!

Elixir bindings for the [namigator](https://github.com/namigator/namigator) pathfinding library.

Namigator provides navigation mesh (navmesh) based pathfinding for World of Warcraft map data. This library wraps the C++ implementation as Erlang NIFs for use in Elixir applications.

## Features

- Load and manage navigation mesh data
- Find paths between two 3D coordinates
- Query terrain heights at specific positions
- Line of sight calculations
- Zone and area ID lookups
- Random point generation within a radius

## Requirements

- Elixir ~> 1.15
- C++17 compatible compiler (GCC 8+, Clang 7+, MSVC 2019+)
- Pre-built navigation mesh data (generated by namigator's map builder)

## Installation

Add `namigator` to your list of dependencies in `mix.exs`:

```elixir
def deps do
  [
    {:namigator, "~> 0.1.0"}
  ]
end
```

## Usage

### Loading a Map

```elixir
# Create a new map from navigation data
{:ok, map} = Namigator.Map.new("/path/to/nav_data", "Azeroth")

# Load all available ADTs (Area Data Tiles)
{:ok, count} = Namigator.Map.load_all_adts(map)
IO.puts("Loaded #{count} ADTs")
```

### Pathfinding

```elixir
# Find a path between two points
start = {-8949.95, -132.493, 83.5312}  # Northshire Abbey
stop = {-9449.06, 64.8392, 56.3581}    # Goldshire

case Namigator.Map.find_path(map, start, stop) do
  {:ok, path} ->
    IO.puts("Found path with #{length(path)} waypoints")
    Enum.each(path, fn {x, y, z} ->
      IO.puts("  #{x}, #{y}, #{z}")
    end)

  {:error, :no_path} ->
    IO.puts("No path found")
end

# Allow partial paths when full path isn't possible
{:ok, partial_path} = Namigator.Map.find_path(map, start, stop, allow_partial: true)
```

### Height Queries

```elixir
# Find height at a position when walking from a source
source = {-8949.95, -132.493, 83.5312}
{:ok, z} = Namigator.Map.find_height(map, source, -8950.0, -133.0)

# Find all heights at a position (for multi-level areas like bridges)
{:ok, heights} = Namigator.Map.find_heights(map, -8949.95, -132.493)
```

### Line of Sight

```elixir
# Check if two points have clear line of sight
start = {-8949.95, -132.493, 83.5312}
stop = {-8960.0, -140.0, 84.0}

if Namigator.Map.line_of_sight?(map, start, stop) do
  IO.puts("Clear line of sight")
else
  IO.puts("Blocked")
end

# Optionally exclude doodads (small objects) from the check
Namigator.Map.line_of_sight?(map, start, stop, include_doodads: false)
```

### Zone and Area Information

```elixir
# Get zone and area IDs at a position
position = {-8949.95, -132.493, 83.5312}

case Namigator.Map.zone_and_area(map, position) do
  {:ok, {zone_id, area_id}} ->
    IO.puts("Zone: #{zone_id}, Area: #{area_id}")

  {:error, :not_found} ->
    IO.puts("Position not on navmesh")
end
```

### Random Points

```elixir
# Find a random navigable point within a radius
center = {-8949.95, -132.493, 83.5312}
radius = 50.0

case Namigator.Map.find_random_point_around_circle(map, center, radius) do
  {:ok, {x, y, z}} ->
    IO.puts("Random point: #{x}, #{y}, #{z}")

  {:error, :not_found} ->
    IO.puts("No valid point found")
end

# Find a point at a specific distance along a path
start = {-8949.95, -132.493, 83.5312}
stop = {-9449.06, 64.8392, 56.3581}
distance = 100.0

{:ok, point} = Namigator.Map.find_point_in_between(map, start, stop, distance)
```

### ADT Management

```elixir
# Check if an ADT exists at grid coordinates
Namigator.Map.has_adt?(map, 32, 48)  # Returns boolean

# Check if an ADT is currently loaded
Namigator.Map.adt_loaded?(map, 32, 48)  # Returns boolean

# Load a specific ADT
Namigator.Map.load_adt(map, 32, 48)  # Returns boolean

# Unload an ADT to free memory
Namigator.Map.unload_adt(map, 32, 48)  # Returns :ok
```

## Building Navigation Data

This library requires pre-built navigation mesh data. Use the namigator map builder tool to generate this data from WoW client files:

1. Clone the namigator repository: https://github.com/namigator/namigator
2. Build the map builder tool
3. Run it against your WoW client data directory
4. Use the output directory as the `data_path` argument

## License

MIT License. See [LICENSE](LICENSE) for details.

This project includes vendored code from:
- [namigator](https://github.com/namigator/namigator) - Navigation mesh library
- [Fine](https://github.com/elixir-nx/fine) - C++ NIF helper library
- [PicoSHA2](https://github.com/okdshin/PicoSHA2) - SHA256 implementation (MIT License)
